<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text to Speech Pro</title>
    <link rel="icon" type="image/x-icon" href="image/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 5s infinite;
        }
        @keyframes twinkle {
            0% { opacity: 0.2; }
            50% { opacity: 1; }
            100% { opacity: 0.2; }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 bg-gray-900">
    <div class="stars"></div>
    <div class="custom-container p-6 sm:p-8 w-full max-w-2xl relative z-10 bg-gray-800 rounded-lg shadow-xl">
        <h1 class="text-3xl sm:text-4xl font-bold text-center mb-6 text-white tracking-wide animate-fade-in">Text to Speech Pro</h1>
        
        <textarea id="textInput" class="w-full p-4 border-2 rounded-lg focus:outline-none focus:ring-4 focus:ring-purple-500 bg-gray-700 text-gray-200 placeholder-gray-500 resize-none transition-all duration-300 shadow-lg" placeholder="Enter text to convert to speech..." maxlength="1000"></textarea>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-6">
            <div>
                <label for="voiceSelect" class="block text-sm font-medium text-gray-300 mb-2">Voice</label>
                <select id="voiceSelect" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-gray-700 text-gray-200 cursor-pointer transition-colors duration-200"></select>
            </div>
            <div>
                <label for="languageFilter" class="block text-sm font-medium text-gray-300 mb-2">Language</label>
                <select id="languageFilter" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-gray-700 text-gray-200 cursor-pointer transition-colors duration-200"></select>
            </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
            <div>
                <label for="rate" class="block text-sm font-medium text-gray-300 mb-2">Speed</label>
                <select id="rate" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-gray-700 text-gray-200 cursor-pointer transition-colors duration-200">
                    <option value="0.5">Slow</option>
                    <option value="1" selected>Normal</option>
                    <option value="1.5">Fast</option>
                    <option value="2">Very Fast</option>
                </select>
            </div>
            <div>
                <label for="pitch" class="block text-sm font-medium text-gray-300 mb-2">Pitch</label>
                <select id="pitch" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-gray-700 text-gray-200 cursor-pointer transition-colors duration-200">
                    <option value="0.5">Low</option>
                    <option value="1" selected>Normal</option>
                    <option value="1.5">High</option>
                    <option value="2">Very High</option>
                </select>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6 mt-8">
            <button id="playBtn" class="btn-primary bg-purple-600 text-white px-8 py-3 rounded-xl hover:bg-purple-700 transition-transform transform hover:scale-105 shadow-lg">Play Audio 🎧</button>
            <button id="downloadBtn" class="btn-secondary bg-gray-600 text-white px-8 py-3 rounded-xl hover:bg-gray-700 transition-transform transform hover:scale-105 shadow-lg">Download Audio 💾</button>
            <button id="reloadVoicesBtn" class="btn-secondary bg-blue-600 text-white px-8 py-3 rounded-xl hover:bg-blue-700 transition-transform transform hover:scale-105 shadow-lg">Reload Voices 🔄</button>
        </div>
        
        <p id="status" class="mt-6 text-sm text-gray-400 text-center hidden"></p>
        
        <div class="footer mt-10">
            <p class="footer-text text-center text-gray-500 text-sm">Created By <span class="text-purple-400 font-medium">Amit Pandey</span></p>
        </div>
    </div>

    <script>
        const synth = window.speechSynthesis;
        const textInput = document.getElementById('textInput');
        const voiceSelect = document.getElementById('voiceSelect');
        const languageFilter = document.getElementById('languageFilter');
        const rate = document.getElementById('rate');
        const pitch = document.getElementById('pitch');
        const status = document.getElementById('status');
        const playBtn = document.getElementById('playBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const reloadVoicesBtn = document.getElementById('reloadVoicesBtn');

        let voices = [];

        // Language map for display
        const languageMap = {
            'en': 'English', 'es': 'Spanish', 'fr': 'French', 'de': 'German', 'it': 'Italian',
            'pt': 'Portuguese', 'ru': 'Russian', 'zh': 'Chinese', 'ja': 'Japanese', 'ko': 'Korean',
            'ar': 'Arabic', 'hi': 'Hindi', 'bn': 'Bengali', 'th': 'Thai', 'he': 'Hebrew',
            'pl': 'Polish', 'nl': 'Dutch', 'sv': 'Swedish', 'tr': 'Turkish', 'vi': 'Vietnamese',
            'da': 'Danish', 'el': 'Greek', 'fi': 'Finnish', 'hu': 'Hungarian', 'id': 'Indonesian',
            'ms': 'Malay', 'no': 'Norwegian', 'sk': 'Slovak', 'uk': 'Ukrainian'
        };

        // Function to create the star background
        function createStars() {
            const starsContainer = document.querySelector('.stars');
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                const size = Math.random() * 2 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 5}s`;
                starsContainer.appendChild(star);
            }
        }

        // Function to populate voices and language dropdowns
        function populateVoices() {
            voices = synth.getVoices();
            console.log('Available voices:', voices.map(v => ({ name: v.name, lang: v.lang }))); // Debug: Log voice details
            showStatus(`Found ${voices.length} voice(s).`, voices.length > 0 ? 'success' : 'error');

            if (voices.length === 0) {
                showStatus('No voices available. Retrying...', 'error');
                setTimeout(populateVoices, 1000); // Retry after 1 second
                return;
            }

            voiceSelect.innerHTML = '';
            const languages = new Set();

            voices.forEach(voice => {
                const langCode = voice.lang.split('-')[0];
                languages.add(langCode);
            });

            // Populate language filter dropdown
            languageFilter.innerHTML = '<option value="all">All Languages</option>';
            Array.from(languages).sort().forEach(lang => {
                const option = document.createElement('option');
                option.value = lang;
                option.textContent = languageMap[lang] || lang.toUpperCase();
                languageFilter.appendChild(option);
            });

            // Filter and populate the voice select dropdown
            filterVoices();
        }

        // Function to filter voices based on selected language
        function filterVoices() {
            const selectedLang = languageFilter.value;
            voiceSelect.innerHTML = '';
            const filteredVoices = voices.filter(voice => selectedLang === 'all' || voice.lang.startsWith(selectedLang));

            if (filteredVoices.length === 0) {
                const noVoiceOption = document.createElement('option');
                noVoiceOption.textContent = 'No voices found for this language.';
                noVoiceOption.disabled = true;
                voiceSelect.appendChild(noVoiceOption);
                showStatus('No voices available for the selected language.', 'error');
            } else {
                filteredVoices.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.value = voices.indexOf(voice);
                    option.textContent = `${voice.name} (${voice.lang})`;
                    voiceSelect.appendChild(option);
                });
                showStatus(`Found ${filteredVoices.length} voice(s) for ${selectedLang === 'all' ? 'all languages' : languageMap[selectedLang] || selectedLang}.`, 'success');
            }
        }

        // Function to speak the text
        function speak() {
            if (synth.speaking) {
                synth.cancel();
            }

            if (!textInput.value.trim()) {
                showStatus('Please enter some text to speak.', 'error');
                return;
            }

            // Ensure voices are loaded
            if (voices.length === 0) {
                showStatus('Voices not loaded. Loading...', 'info');
                populateVoices();
                setTimeout(speak, 1000); // Retry after voices load
                return;
            }

            const utterance = new SpeechSynthesisUtterance(textInput.value);
            const selectedVoiceIndex = voiceSelect.value;
            const selectedVoice = voices[selectedVoiceIndex];

            if (!selectedVoice) {
                showStatus('No voice selected or available.', 'error');
                return;
            }

            console.log('Selected voice:', { name: selectedVoice.name, lang: selectedVoice.lang }); // Debug: Log selected voice
            utterance.voice = selectedVoice;
            utterance.rate = parseFloat(rate.value);
            utterance.pitch = parseFloat(pitch.value);

            utterance.onstart = () => {
                showStatus(`Playing audio with voice: ${selectedVoice.name}`, 'info');
            };

            utterance.onend = () => {
                showStatus('Playback finished.', 'success');
                setTimeout(hideStatus, 2000);
            };

            utterance.onerror = (event) => {
                console.error('SpeechSynthesisUtterance.onerror', event);
                showStatus('Error during speech synthesis.', 'error');
            };

            synth.speak(utterance);
        }

        // Function to show status messages
        function showStatus(message, type = 'info') {
            status.textContent = message;
            status.classList.remove('hidden', 'text-gray-400', 'text-red-400', 'text-green-400');
            if (type === 'error') {
                status.classList.add('text-red-400');
            } else if (type === 'success') {
                status.classList.add('text-green-400');
            } else {
                status.classList.add('text-gray-400');
            }
        }

        // Function to hide status messages
        function hideStatus() {
            status.classList.add('hidden');
        }

        // Dummy download function
        function downloadSpeech() {
            showStatus('⚠️ Note: Direct MP3 download is not supported by the browser\'s API. Use a server-side service (e.g., Google Cloud TTS).', 'error');
        }

        // Event listeners
        if (synth) {
            // Handle voices changed event
            synth.onvoiceschanged = () => {
                console.log('Voices changed event fired'); // Debug
                populateVoices();
            };

            // Try to load voices immediately
            populateVoices();

            // Fallback: Retry loading voices after a delay
            setTimeout(() => {
                if (voices.length === 0) {
                    console.log('Retrying to load voices...');
                    populateVoices();
                }
            }, 2000);

            // Manual voice reload button
            reloadVoicesBtn.addEventListener('click', () => {
                showStatus('Reloading voices...', 'info');
                populateVoices();
            });

            // Play button with voice check
            playBtn.addEventListener('click', () => {
                if (voices.length === 0) {
                    showStatus('Loading voices, please wait...', 'info');
                    populateVoices();
                    setTimeout(speak, 1000);
                } else {
                    speak();
                }
            });

            languageFilter.addEventListener('change', filterVoices);
            downloadBtn.addEventListener('click', downloadSpeech);
        } else {
            showStatus('Your browser does not support the Web Speech API.', 'error');
            playBtn.disabled = true;
            downloadBtn.disabled = true;
            reloadVoicesBtn.disabled = true;
        }

        // Initial setup
        createStars();
    </script>
</body>
</html>
